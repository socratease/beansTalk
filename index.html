<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>beansTalk</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        html, body, #root {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        // Fetch the JSX file, transform it with Babel, and execute
        async function loadApp() {
            try {
                // Get the base path for GitHub Pages (handles both root and PR preview deployments)
                // This handles URLs with or without trailing slashes
                let basePath = window.location.pathname;
                const lastSegment = basePath.substring(basePath.lastIndexOf('/') + 1);
                if (!lastSegment.includes('.')) {
                    // We're at a directory - ensure trailing slash
                    if (!basePath.endsWith('/')) {
                        basePath += '/';
                    }
                } else {
                    // We're at a file (like index.html) - get the directory part
                    basePath = basePath.substring(0, basePath.lastIndexOf('/') + 1);
                }
                const jsxUrl = `${window.location.origin}${basePath}beanstalk-preview.jsx`;

                const response = await fetch(jsxUrl);
                if (!response.ok) {
                    throw new Error(`Failed to load component: ${response.status}`);
                }
                const jsxCode = await response.text();

                // Transform JSX to JavaScript using Babel
                const result = Babel.transform(jsxCode, {
                    presets: ['react']
                });

                // Execute the transformed code
                eval(result.code);

                // Render the app
                const root = ReactDOM.createRoot(document.getElementById('root'));
                root.render(React.createElement(BeansTalkPresentation));
            } catch (error) {
                console.error('Error loading app:', error);
                document.getElementById('root').innerHTML = `
                    <div style="padding: 20px; color: red;">
                        <h1>Error loading application</h1>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        loadApp();
    </script>
</body>
</html>
